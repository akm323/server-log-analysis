<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Entry Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Log Entry Analysis</h1>

    <!-- Dropdown for IP filter -->
    <label for="ip_address">Filter by IP Address:</label>
    <select id="ip_address" name="ip_address" onchange="updateGraph()">
        {% for ip in ip_addresses %}
        <option value="{{ ip }}">{{ ip }}</option>
        {% endfor %}
    </select>

    <!-- Graph for the number of requests per path -->
    <div id="plot-div-requests"></div>

    <!-- Graph for the requests over time -->
    <div id="plot-div-time"></div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <script>
        function updateGraph() {
            const ip_address = document.getElementById('ip_address').value;
            console.log('Selected IP:', ip_address);  // Debug: Check if this is being logged
    
            axios.post('/track_ip', { ip_address: ip_address })
                .then(function (response) {
                    console.log('Graph data:', response.data);  // Debug: Log the received data
    
                    // Parse the received JSON data for both graphs
                    const graphRequests = JSON.parse(response.data.graph_requests);  // Requests per path
                    const graphTime = JSON.parse(response.data.graph_time);  // Requests over time
    
                    // Update the graph for "Number of Requests per Path"
                    if (graphRequests.data && graphRequests.layout) {
                        Plotly.react('plot-div-requests', graphRequests.data, graphRequests.layout);
                    } else {
                        console.error('Invalid requests graph data format:', graphRequests);
                    }
    
                    // Update the graph for "Requests Over Time"
                    if (graphTime.data && graphTime.layout) {
                        Plotly.react('plot-div-time', graphTime.data, graphTime.layout);
                    } else {
                        console.error('Invalid time graph data format:', graphTime);
                    }
                })
                .catch(function (error) {
                    console.error('Error updating graph:', error);
                });
        }
    
        // Add event listener to trigger graph update on dropdown change
        document.getElementById('ip_address').addEventListener('change', updateGraph);
    
        // Load default graph on page load
        window.onload = updateGraph;
    </script>
    
</body>
</html>